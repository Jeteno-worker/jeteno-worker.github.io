<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iqos-mvp</title>
    <!-- <script type="module" crossorigin src="/assets/index-Cr4BhDd0.js"></script> -->
    <link rel="stylesheet" crossorigin href="/assets/index-DsQpcWzI.css">
  </head>
  <body>
    <!-- <div id="root"></div> -->
    <div>
      <button id="requestBluetoothDevice">Запросить устройство Bluetooth</button>
      <button id="forgetBluetoothDevice">Забыть выбранное устройство</button>
    </div>
    <div>
      <select id="devicesSelect">
        <option value="">-- Выберите устройство --</option>
      </select>
    </div>
    <div>
      <h4>Лог:</h4>
      <div id="log" class="log"></div>
    </div>
    <script>
      function populateBluetoothDevices() {
  const devicesSelect = document.querySelector('#devicesSelect');
  log('Getting existing permitted Bluetooth devices...');
  navigator.bluetooth.getDevices()
  .then(devices => {
    console.log('> Got ' + devices.length + ' Bluetooth devices.');
    devicesSelect.textContent = '';
    for (const device of devices) {
      const option = document.createElement('option');
      option.value = device.id;
      option.textContent = device.name;
      devicesSelect.appendChild(option);
    }
  })
  .catch(error => {
    console.log('Argh! ' + error);
  });
}

function onRequestBluetoothDeviceButtonClick() {
  console.log('Requesting any Bluetooth device...');
  navigator.bluetooth.requestDevice({
 // filters: [...] <- Prefer filters to save energy & show relevant devices.
    acceptAllDevices: true
  })
  .then(device => {
    console.log('> Requested ' + device.name + ' (' + device.id + ')');
    populateBluetoothDevices();
  })
  .catch(error => {
    console.log('Argh! ' + error);
  });
}

function onForgetBluetoothDeviceButtonClick() {
  navigator.bluetooth.getDevices()
  .then(devices => {
    const deviceIdToForget = document.querySelector('#devicesSelect').value;
    const device = devices.find((device) => device.id == deviceIdToForget);
    if (!device) {
      throw new Error('No Bluetooth device to forget');
    }
    console.log('Forgetting ' + device.name + 'Bluetooth device...');
    return device.forget();
  })
  .then(() => {
    console.log('  > Bluetooth device has been forgotten.');
    populateBluetoothDevices();
  })
  .catch(error => {
    console.log('Argh! ' + error);
  });
}

window.onload = () => {
  populateBluetoothDevices();
};
    </script>
  </body>
</html>
